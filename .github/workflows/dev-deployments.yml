name: Dev Deployments

on:
  pull_request:
    paths:
      - "src/**"
    branches:
      - "dev"

jobs:

  # Deploys the web app
  # web-app:
  #   runs-on: [self-hosted, dev]

  #   steps:
  #   - uses: actions/checkout@v2
  #   - uses: actions/setup-node@v2
  #     with:
  #       node-version: '14'

  #   - name: Installing dependencies
  #     run: npm ci

  #   - name: Compiling app
  #     run: npm run build

  #   - name: Stopping IIS Pool
  #     run: c:\batch\elevate Stop-WebAppPool -Name devapp

  #   - name: Deploying app
  #     run: Copy-Item ./dist/rithm/* C:/inetpub/devapp.rithm.tech -Recurse -Force

  #   - name: Starting IIS Pool
  #     run: c:\batch\elevate Start-WebAppPool -Name devapp

  # Deploys the Karma test coverage site
  test-coverage:
    runs-on: [self-hosted, dev]

    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v2
      with:
        node-version: '14'

    - name: Installing dependencies
      run: npm ci

    - name: Generating test coverage
      run: npm run test-ci

    - name: Stopping IIS Pool
      run: c:\batch\elevate Stop-WebAppPool -Name devapp

    - name: Deploying documentation site
      run: |
        Copy-Item ./coverage/rithm/* C:/inetpub/devapp.rithm.tech/karmacoverage -Recurse -Force

    - name: Starting IIS Pool
      run: c:\batch\elevate Start-WebAppPool -Name devapp

  # Deploys the Compodoc documentation site
  # compodoc:
  #   runs-on: [self-hosted, dev]

  #   steps:
  #   - uses: actions/checkout@v2

  #   - name: Installing dependencies
  #     run: npm ci

  #   - name: Compiling documentation
  #     run: npm run compile-docs

  #   - name: Deploying documentation site
  #     run: |
  #       iisreset /stop
  #       Copy-Item ./documentation/* C:/inetpub/devapp.rithm.tech/compodoc -Recurse -Force
  #       iisreset /start

  # Deploys the SassDoc documentation site
  # sassdoc:
  #   runs-on: [self-hosted, dev]

  #   steps:
  #   - uses: actions/checkout@v2

  #   - name: Installing dependencies
  #     run: npm ci

  #   - name: Compiling documentation
  #     run: npm run compile-style-docs

  #   - name: Deploying documentation site
  #     run: |
  #       iisreset /stop
  #       Copy-Item ./sassdoc/* C:/inetpub/devapp.rithm.tech/sassdoc -Recurse -Force
  #       iisreset /start
