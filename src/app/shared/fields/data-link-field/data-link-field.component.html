<div [formGroup]="dataLinkFieldForm" class="flex flex-col">
  <div class="flex flex-row justify-start text-xs space-x-2 mb-2">
    <span class="text-primary-500">DATA LINK</span>
    <mat-divider [vertical]="true"></mat-divider>
    <a
      href="javascript: void(0)"
      class="underline cursor-pointer text-accent-500"
      >Help</a
    >
  </div>
  <!-- Available Stations  -->
  <mat-form-field class="md:w-2/5 w-full" appearance="outline">
    <mat-label>{{ field.prompt }}</mat-label>
    <div matPrefix class="icon">
      <!-- Data link icon -->
      <i class="fas fa-search"></i>
    </div>
    <input
      id="data-link-search"
      matInput
      [required]="field.isRequired"
      [formControlName]="field.questionType"
      [matAutocomplete]="auto"
    />
    <mat-autocomplete
      autoActiveFirstOption
      #auto="matAutocomplete"
      (optionSelected)="getStationQuestions($event.option.value)"
    >
      <mat-option *ngIf="stationLoading" class="flex justify-center">
        <app-loading-indicator [inlineText]="'Loading...'">
        </app-loading-indicator>
      </mat-option>
      <mat-option
        class="text-sm"
        *ngFor="let option of filteredStations$ | async"
        [value]="option.name"
      >
        <p *ngIf="option.name">{{ option.name }}</p>
      </mat-option>
    </mat-autocomplete>
  </mat-form-field>
  <!-- Matching Value -->
  <mat-form-field class="md:w-2/5 w-full" appearance="outline">
    <mat-label
      >{{ questionLoading ? 'Loading Questions' : matchingValueLabel }}
      <i *ngIf="questionLoading" class="fa-solid fa-spin fa-spinner fa-2x1">
      </i>
    </mat-label>

    <mat-select
      [disabled]="!questions.length || questionLoading"
      formControlName="selectedMatchingValue"
    >
      <ng-container *ngFor="let option of questions">
        <mat-option
          *ngIf="option.prompt"
          class="text-sm"
          [value]="option.rithmId"
        >
          <p>{{ option.prompt }}</p>
        </mat-option>
      </ng-container>
    </mat-select>
  </mat-form-field>
  <!-- Base Value-->
  <mat-form-field class="md:w-2/5 w-full" appearance="outline">
    <mat-label> Base Value </mat-label>
    <mat-select formControlName="selectBaseValue">
      <ng-container *ngFor="let item of currentStationQuestions">
        <mat-option *ngIf="item.prompt" [value]="item.rithmId">
          {{ item.prompt }}
        </mat-option>
      </ng-container>
    </mat-select>
  </mat-form-field>
  <!-- Display Fields  -->
  <mat-form-field class="md:w-2/5 w-full" appearance="outline">
    <mat-label
      >{{ questionLoading ? 'Loading Questions' : displayFieldsLabel }}
      <i *ngIf="questionLoading" class="fa-solid fa-spin fa-spinner fa-2x1">
      </i>
    </mat-label>
    <mat-select
      #selectDisplayFields
      multiple
      [disabled]="!questions.length || questionLoading"
      formControlName="selectedDisplayFields"
    >
      <div (mouseleave)="selectDisplayFields.close()">
        <ng-container *ngFor="let option of questions">
          <mat-option
            *ngIf="option.prompt"
            class="text-sm"
            [value]="option.rithmId"
          >
            <p>{{ option.prompt }}</p>
          </mat-option>
        </ng-container>
      </div>
    </mat-select>
  </mat-form-field>
</div>
