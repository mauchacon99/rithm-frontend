<!--Loading the widget-->
<app-loading-widget
  *ngIf="isLoading"
  id="app-loading-indicator"
></app-loading-widget>

<!--Show error in the widget-->
<app-error-widget
  *ngIf="failedLoadWidget"
  id="error-load-widget"
  [errorMessage]="'Unable to retrieve station data'"
  (tryAgain)="getStationWidgetDocuments()"
>
</app-error-widget>

<!-- station widget -->
<div
  *ngIf="!isLoading && !failedLoadWidget && !isDocument"
  id="show-docs"
  class="h-full w-full"
>
  <!-- Header widget -->
  <div class="w-full p-2 flex flex-col h-full">
    <!--  Header Container  -->
    <div class="m-2">
      <div class="flex justify-between items-center">
        <h3 *ngIf="dataStationWidget" class="font-semibold truncate">
          {{ dataStationWidget.stationName }}
        </h3>
        <div *ngIf="dataStationWidget && !editMode">
          <button
            *ngIf="dataStationWidget.documentGeneratorStatus === 'Manual'"
            mat-stroked-button
            color="accent"
            data-testid="create-new-document"
            id="create-new-document"
            (click)="createNewDocument()"
          >
            New Document <i class="fas fa-plus"></i>
          </button>
          <div
            *ngIf="displayDocumentError"
            class="text-error-500 text-xs p-0.5"
            data-testid="create-document-error"
            id="create-document-error"
          >
            Document not created!
          </div>
        </div>
        <div *ngIf="editMode" id="gear-icon">
          <button
            mat-icon-button
            [disabled]="isDrawerOpen && drawerContext === 'stationWidget'"
            (click)="toggleEditStation()"
            id="toggle-edit-station"
            data-testid="toggle-edit-station"
            class="text-secondary-500"
          >
            <i class="fas fa-cog text-[16px]"></i>
          </button>
        </div>
      </div>
    </div>
    <!--    Column Headers-->
    <div class="grid grid-cols-12 text-xs text-secondary-500 py-2">
      <p class="col-span-5 overline-font truncate">Document</p>
      <p class="col-span-2 overline-font truncate text-center">Assigned</p>
      <p class="col-span-2 overline-font truncate text-center">Priority</p>
      <p class="col-span-3 sm:col-span-2 overline-font truncate">
        Time in Station
      </p>
    </div>
    <!--    Row Container-->
    <div class="flex-grow overflow-auto scrollbar">
      <div
        *ngIf="!dataStationWidget.documents.length"
        class="text-center my-4 text-sm"
        id="no-docs-message"
      >
        No documents found in station.
      </div>
      <div
        *ngIf="dataStationWidget"
        class="grid grid-cols-12 text-secondary-500 items-center"
      >
        <ng-container *ngFor="let document of dataStationWidget.documents">
          <div
            class="col-span-5 py-4 border-solid border-b border-b-primary-100 text-xs truncate text-primary-500"
          >
            {{ document.name || 'Untitled Document' }}
          </div>
          <div
            *ngIf="document.assignedUser"
            class="col-span-2 h-[49px] border-solid border-b border-b-primary-100"
          >
            <div class="flex justify-center mt-2">
              <app-user-avatar
                [firstName]="document.assignedUser.firstName"
                [lastName]="document.assignedUser.lastName"
              >
              </app-user-avatar>
            </div>
          </div>
          <div
            *ngIf="!document.assignedUser"
            class="col-span-2 py-4 border-solid border-b border-b-primary-100 text-xs truncate text-center"
          >
            None
          </div>
          <div
            class="col-span-2 py-4 border-solid border-b border-b-primary-100 text-xs justify-center"
          >
            <div class="flex justify-center">
              <i class="fas fa-exclamation-triangle"></i>
              <!--      {{ document.priority }}-->
            </div>
          </div>
          <div
            class="col-span-2 py-4 border-solid border-b border-b-primary-100 text-xs truncate text-primary-500"
          >
            {{ getElapsedTime(document.flowedTimeUTC) }}
          </div>
          <div
            class="col-span-1 border-solid border-b border-b-primary-100 pb-2 text-center"
          >
            <button
              (click)="viewDocument(document.rithmId)"
              mat-icon-button
              data-testid="show-document-widget"
              id="show-document-widget"
              [disabled]="editMode"
            >
              <i class="fas fa-angle-double-right"></i>
            </button>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>

<!--Document detail-->
<div
  class="h-full p-2 overflow-auto"
  *ngIf="isDocument && !isLoading"
  id="document-detail"
>
  <!--  Header -->
  <div class="flex justify-between items-center">
    <button
      [disabled]="
        documentComponent
          ? documentComponent.documentLoading === undefined
            ? true
            : documentComponent.documentLoading
          : true
      "
      mat-icon-button
      (click)="viewDocument('', true)"
      id="return-list-documents"
      data-testid="return-list-documents"
    >
      <i
        [ngClass]="{
          'text-secondary-300': documentComponent
            ? documentComponent.documentLoading === undefined
              ? true
              : documentComponent.documentLoading
            : true
        }"
        class="fas text-secondary-500 fa-arrow-left text-lg"
      ></i>
    </button>
    <button
      mat-icon-button
      (click)="toggleExpandWidget()"
      id="expand-document"
      data-testid="expand-document"
    >
      <i
        [ngClass]="isExpandWidget ? 'fa-compress-alt' : 'fa-expand-alt'"
        class="fas text-secondary-500 text-lg"
      ></i>
    </button>
  </div>
  <!--  Document component -->
  <div class="container-document">
    <app-document
      [isWidget]="true"
      (returnDocumentsWidget)="viewDocument('', $event)"
      [documentRithmIdWidget]="documentIdSelected"
      [stationRithmIdWidget]="stationRithmId"
    ></app-document>
  </div>
</div>
