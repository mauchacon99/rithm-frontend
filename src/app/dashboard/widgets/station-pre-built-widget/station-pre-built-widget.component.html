<!--Loading the widget-->
<app-loading-widget
  *ngIf="isLoading"
  id="app-loading-indicator-station-pre-built"
></app-loading-widget>
<!--Show error in the widget-->
<app-error-widget
  *ngIf="errorStationPrebuilt"
  id="error-load-widget-station-pre-built"
  [errorMessage]="'Unable to retrieve stations data'"
  (tryAgain)="getStationWidgetPreBuiltData()"
>
</app-error-widget>
<div
  *ngIf="!isLoading && !errorStationPrebuilt && stationWidgetData"
  class="h-full w-full p-2"
>
  <div class="flex justify-between items-center">
    <h3 class="font-semibold truncate mb-2">My Stations</h3>
    <div *ngIf="editMode && showButtonSetting">
      <button
        mat-icon-button
        [disabled]="isDrawerOpen && drawerContext !== 'menuDashboard'"
        (click)="toggleEditStation()"
        id="toggle-edit-station-pre-built"
        data-testid="toggle-edit-station-pre-built"
        class="text-secondary-500"
      >
        <i class="fas fa-cog text-base"></i>
      </button>
    </div>
  </div>

  <div class="flex-grow overflow-auto scrollbar h-[calc(100%-40px)]">
    <ng-container
      *ngIf="stationWidgetData.length; then tableStations; else emptyStations"
    >
    </ng-container>
  </div>
</div>

<ng-template #tableStations>
  <table mat-table [dataSource]="dataSourceTable" class="w-full">
    <!-- Name Station -->
    <ng-container matColumnDef="stationName">
      <th
        mat-header-cell
        *matHeaderCellDef
        class="font-semibold truncate pr-2 max-w-[150px] text-xs"
      >
        STATION
      </th>
      <td
        mat-cell
        *matCellDef="let element"
        class="min-w-[150px] px-2 text-xs text-secondary-500"
      >
        {{ element['stationName']?.trim() || 'N/A' }}
      </td>
    </ng-container>

    <!-- Total Containers -->
    <ng-container matColumnDef="totalContainers">
      <th
        mat-header-cell
        *matHeaderCellDef
        class="font-semibold truncate pr-2 max-w-[150px] text-xs"
      >
        CONTAINERS
      </th>
      <td
        mat-cell
        *matCellDef="let element"
        class="min-w-[150px] px-2 text-xs text-secondary-500"
      >
        <a *ngIf="!editMode" (click)="openDocsModal(element)"
          >{{ element['totalContainers'] }} Containers</a
        >
        <span *ngIf="editMode"
          >{{ element['totalContainers'] }} Containers</span
        >
      </td>
    </ng-container>

    <!-- Station Group -->
    <ng-container matColumnDef="stationGroup">
      <th
        mat-header-cell
        *matHeaderCellDef
        class="font-semibold truncate pr-2 max-w-[150px] text-xs"
      >
        GROUP
      </th>
      <td
        mat-cell
        *matCellDef="let element"
        class="min-w-[150px] px-2 text-xs text-secondary-500"
      >
        {{ element['stationGroup']?.trim() || 'N/A' }}
      </td>
    </ng-container>

    <!-- Station Owners -->
    <ng-container matColumnDef="stationOwners">
      <th
        mat-header-cell
        *matHeaderCellDef
        class="font-semibold truncate pr-2 max-w-[150px] text-xs"
      >
        STATION OWNERS
      </th>
      <td
        mat-cell
        *matCellDef="let element"
        class="min-w-[150px] px-2 text-xs text-secondary-500"
      >
        <div class="ml-2.5">
          <app-roster
            [stationId]="element['stationRithmId'] || ''"
            [isWorker]="false"
            [editMode]="!editMode"
            [stationMembers]="element['stationOwners']"
            [fromDrawer]="true"
          >
          </app-roster>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
</ng-template>

<ng-template #emptyStations>
  <div class="text-center my-4 text-sm">There are not stations.</div>
</ng-template>
