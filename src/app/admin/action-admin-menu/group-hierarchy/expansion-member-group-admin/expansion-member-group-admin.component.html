<mat-expansion-panel
  hideToggle
  (opened)="panelOpenState = true"
  (closed)="panelOpenState = false"
  class="expansion-member"
>
  <mat-expansion-panel-header class="bg-secondary-50">
    <mat-panel-title id="expansion-option" data-testid="expansion-option">
      <div class="w-full flex justify-between">
        <div class="flex items-center">
          <i
            [ngClass]="panelOpenState ? 'fa-angle-down' : 'fa-angle-right'"
            class="fas text-lg ml-5"
          ></i>
          <span class="ml-8">{{ isAdmin ? 'ADMINS' : 'USERS' }} </span>
        </div>
        <button
          mat-icon-button
          id="add-user-button"
          data-testid="add-user-button"
          (click)="$event.stopPropagation()"
        >
          <i class="fa-solid fa-user-plus text-secondary-500"></i>
        </button>
      </div>
    </mat-panel-title>
  </mat-expansion-panel-header>

  <div class="loading flex" *ngIf="isLoading">
    <app-loading-indicator
      class="flex-grow m-auto"
      id="loading-get-members"
    ></app-loading-indicator>
  </div>

  <div *ngIf="isErrorGetUsers" id="failed-get-users" class="px-5">
    <p class="text-error-500">Error: Station users cannot be displayed.</p>
  </div>

  <mat-list
    class="list-options"
    *ngIf="members && !isLoading && !isErrorGetUsers"
  >
    <div class="px-5" *ngIf="!members.length">
      <p class="text-error-500">There are no members to display.</p>
    </div>

    <div *ngFor="let member of members">
      <mat-list-item
        matRipple
        class="item hover:bg-accent-50 cursor-pointer border-b color-border"
      >
        <div class="flex justify-between items-center">
          <div class="flex space-x-3 items-center">
            <app-user-avatar
              [firstName]="member.firstName"
              [lastName]="member.lastName"
            >
            </app-user-avatar>
            <div class="flex flex-col">
              <span class="text-sm">{{
                member.firstName + member.lastName
              }}</span>
              <span class="text-sm text-accent-500">{{ member.email }}</span>
            </div>
          </div>

          <button
            mat-icon-button
            id="option-button"
            data-testid="option-button"
            (click)="$event.stopPropagation()"
            class="showButton"
          >
            <i class="fa-solid fa-ellipsis-vertical"></i>
          </button>
        </div>
      </mat-list-item>
    </div>
  </mat-list>
</mat-expansion-panel>
